<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>02.04 - Gestione Eventi Multipli e Delegazione</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .demo-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .log {
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #48bb78;
            padding-left: 10px;
        }

        .code-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            font-size: 14px;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .button-grid button {
            margin: 0;
        }

        .delegated-container {
            border: 3px dashed #667eea;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            background: white;
        }

        .delegated-item {
            background: #e6fffa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #38b2ac;
            cursor: pointer;
            transition: all 0.3s;
        }

        .delegated-item:hover {
            background: #b2f5ea;
            transform: translateX(5px);
        }

        .dynamic-list {
            list-style: none;
        }

        .dynamic-list li {
            background: #fef5e7;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #f39c12;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .delete-btn {
            background: #e74c3c;
            padding: 6px 12px;
            font-size: 14px;
        }

        .stats-display {
            background: #ebf8ff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 2px solid #4299e1;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }

        .todo-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
        }

        .todo-input {
            width: 70%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 16px;
        }

        .todo-item {
            background: #f7fafc;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #48bb78;
        }

        .todo-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
            border-left-color: #cbd5e0;
        }

        .comparison-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }

        .comparison-panel {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }

        .comparison-panel h4 {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }

        .badge-good {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-bad {
            background: #fed7d7;
            color: #742a2a;
        }

        @media (max-width: 768px) {
            .comparison-split {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ 02.04 - Gestione Eventi Multipli e Delegazione</h1>

        <!-- Sezione 1: Approccio Na√Øve (ciclo) -->
        <div class="section">
            <h2>1. Approccio Na√Øve: Ciclo su Elementi</h2>
            <p>Aggiunta di un gestore a ogni elemento individualmente. <span class="badge badge-bad">Non ottimale</span></p>
            
            <div class="demo-area">
                <div class="button-grid" id="grid1">
                    <button class="naive-btn" data-id="1">Bottone 1</button>
                    <button class="naive-btn" data-id="2">Bottone 2</button>
                    <button class="naive-btn" data-id="3">Bottone 3</button>
                    <button class="naive-btn" data-id="4">Bottone 4</button>
                    <button class="naive-btn" data-id="5">Bottone 5</button>
                    <button class="naive-btn" data-id="6">Bottone 6</button>
                </div>
                
                <button onclick="addNaiveButton()">‚ûï Aggiungi Bottone (non funzioner√†!)</button>
                
                <div class="code-display">
// ‚ùå Approccio Na√Øve - un gestore per ogni elemento
const buttons = document.querySelectorAll('.naive-btn');

buttons.forEach(function(button) {
    button.addEventListener('click', function() {
        console.log('Cliccato:', button.textContent);
    });
});

// ‚ö†Ô∏è PROBLEMA: i bottoni aggiunti DOPO non avranno il gestore!</div>

                <div class="stats-display">
                    <div class="stat-item">
                        <div class="stat-value" id="naive-handlers">6</div>
                        <div class="stat-label">Gestori Attivi</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="naive-clicks">0</div>
                        <div class="stat-label">Click Totali</div>
                    </div>
                </div>
            </div>
            <div id="log1" class="log"></div>
        </div>

        <!-- Sezione 2: Event Delegation Base -->
        <div class="section">
            <h2>2. Event Delegation - Approccio Migliore</h2>
            <p>Un singolo gestore sul contenitore gestisce tutti gli eventi dei figli. <span class="badge badge-good">Ottimale</span></p>
            
            <div class="demo-area">
                <div class="delegated-container" id="delegated-container1">
                    <p><strong>üì¶ Contenitore con Event Delegation</strong></p>
                    <div class="delegated-item" data-id="1">üìÑ Item 1 - Clicca qui</div>
                    <div class="delegated-item" data-id="2">üìÑ Item 2 - Clicca qui</div>
                    <div class="delegated-item" data-id="3">üìÑ Item 3 - Clicca qui</div>
                </div>
                
                <button onclick="addDelegatedItem()">‚ûï Aggiungi Item (funzioner√†!)</button>
                
                <div class="code-display">
// ‚úÖ Event Delegation - un solo gestore sul contenitore
const container = document.querySelector('.container');

container.addEventListener('click', function(event) {
    // Verifica se l'elemento cliccato √® un item
    if (event.target.classList.contains('delegated-item')) {
        console.log('Item cliccato:', event.target.textContent);
    }
});

// ‚úÖ VANTAGGIO: elementi aggiunti DOPO funzionano automaticamente!</div>

                <div class="stats-display">
                    <div class="stat-item">
                        <div class="stat-value">1</div>
                        <div class="stat-label">Gestore (sul container)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="delegated-items">3</div>
                        <div class="stat-label">Items Gestiti</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="delegated-clicks">0</div>
                        <div class="stat-label">Click Totali</div>
                    </div>
                </div>
            </div>
            <div id="log2" class="log"></div>
        </div>

        <!-- Sezione 3: Uso di closest() -->
        <div class="section">
            <h2>3. Event Delegation con closest()</h2>
            <p>Il metodo <code>closest()</code> trova l'antenato pi√π vicino che corrisponde al selettore.</p>
            
            <div class="demo-area">
                <div class="delegated-container" id="delegated-container2">
                    <div class="delegated-item">
                        <strong>üìÑ Item con Elementi Figli</strong>
                        <p style="margin: 5px 0; font-size: 14px;">Clicca ovunque qui dentro</p>
                        <button onclick="event.stopPropagation()" style="font-size: 14px; padding: 8px;">Bottone Interno</button>
                    </div>
                    <div class="delegated-item">
                        <strong>üìÑ Altro Item</strong>
                        <span style="color: #718096;">con testo interno</span>
                    </div>
                </div>
                
                <div class="code-display">
// ‚úÖ closest() trova l'antenato che corrisponde
container.addEventListener('click', function(event) {
    // Trova l'item pi√π vicino, anche se clicchi su un elemento figlio
    const item = event.target.closest('.delegated-item');
    
    if (item) {
        console.log('Item trovato:', item);
    }
});

// Funziona anche se clicchi su &lt;strong&gt;, &lt;p&gt;, &lt;span&gt;, etc.</div>
            </div>
            <div id="log3" class="log"></div>
        </div>

        <!-- Sezione 4: Lista Dinamica con Eliminazione -->
        <div class="section">
            <h2>4. Lista Dinamica con Event Delegation</h2>
            <p>Esempio pratico: lista con possibilit√† di aggiungere ed eliminare elementi.</p>
            
            <div class="demo-area">
                <div>
                    <input type="text" id="item-input" class="todo-input" placeholder="Scrivi un item...">
                    <button onclick="addListItem()">‚ûï Aggiungi</button>
                </div>
                
                <ul class="dynamic-list" id="dynamic-list"></ul>
                
                <div class="code-display">
// Un solo gestore gestisce TUTTI i bottoni di eliminazione
list.addEventListener('click', function(event) {
    if (event.target.classList.contains('delete-btn')) {
        const li = event.target.closest('li');
        li.remove();
    }
});

// Nuovi elementi aggiunti funzionano automaticamente!</div>
            </div>
            <div id="log4" class="log"></div>
        </div>

        <!-- Sezione 5: Todo List Completa -->
        <div class="section">
            <h2>5. Todo List con Event Delegation Completo</h2>
            <p>Esempio completo con multiple azioni (completa, elimina, modifica).</p>
            
            <div class="demo-area">
                <div class="todo-container">
                    <div>
                        <input type="text" id="todo-input" class="todo-input" placeholder="Nuova task...">
                        <button onclick="addTodo()">‚ûï Aggiungi Task</button>
                    </div>
                    
                    <div id="todo-list"></div>
                </div>
                
                <div class="code-display">
// Un gestore gestisce TUTTE le azioni
todoList.addEventListener('click', function(event) {
    const target = event.target;
    const todoItem = target.closest('.todo-item');
    
    if (target.matches('.complete-btn')) {
        todoItem.classList.toggle('completed');
    } else if (target.matches('.delete-btn')) {
        todoItem.remove();
    } else if (target.matches('.edit-btn')) {
        editTodo(todoItem);
    }
});</div>
            </div>
            <div id="log5" class="log"></div>
        </div>

        <!-- Sezione 6: Confronto Performance -->
        <div class="section">
            <h2>6. Confronto: Ciclo vs Delegazione</h2>
            <p>Differenza di performance e memoria tra i due approcci.</p>
            
            <div class="demo-area">
                <div class="comparison-split">
                    <div class="comparison-panel">
                        <h4>‚ùå Ciclo (forEach)</h4>
                        <p><strong>Gestori:</strong> N (uno per elemento)</p>
                        <p><strong>Memoria:</strong> Alta (N√ógestore)</p>
                        <p><strong>Elementi dinamici:</strong> Non funzionano</p>
                        <p><strong>Manutenzione:</strong> Difficile</p>
                        <button onclick="runLoopTest()">Test con 100 elementi</button>
                        <div id="loop-result" style="margin-top: 10px; font-weight: bold;"></div>
                    </div>
                    
                    <div class="comparison-panel">
                        <h4>‚úÖ Event Delegation</h4>
                        <p><strong>Gestori:</strong> 1 (sul contenitore)</p>
                        <p><strong>Memoria:</strong> Bassa (1 gestore)</p>
                        <p><strong>Elementi dinamici:</strong> Funzionano</p>
                        <p><strong>Manutenzione:</strong> Facile</p>
                        <button onclick="runDelegationTest()">Test con 100 elementi</button>
                        <div id="delegation-result" style="margin-top: 10px; font-weight: bold;"></div>
                    </div>
                </div>
                
                <div class="code-display">
// Ciclo: 100 elementi = 100 gestori in memoria
buttons.forEach(btn => {
    btn.addEventListener('click', handler); // √ó100
});

// Delegazione: 100 elementi = 1 solo gestore in memoria
container.addEventListener('click', function(e) {
    if (e.target.matches('button')) {
        handler(e);
    }
}); // √ó1</div>
            </div>
            <div id="log6" class="log"></div>
        </div>

    </div>

    <script>
        // Utility per logging
        function addLog(logId, message, type = 'info') {
            const log = document.getElementById(logId);
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // Sezione 1: Approccio Na√Øve
        let naiveClicks = 0;
        let naiveButtonCount = 6;

        const naiveButtons = document.querySelectorAll('.naive-btn');
        naiveButtons.forEach(function(button) {
            button.addEventListener('click', function() {
                naiveClicks++;
                document.getElementById('naive-clicks').textContent = naiveClicks;
                addLog('log1', `‚ùå Na√Øve: Bottone ${button.dataset.id} cliccato (gestore individuale)`);
            });
        });

        function addNaiveButton() {
            naiveButtonCount++;
            const btn = document.createElement('button');
            btn.className = 'naive-btn';
            btn.dataset.id = naiveButtonCount;
            btn.textContent = `Bottone ${naiveButtonCount}`;
            document.getElementById('grid1').appendChild(btn);
            
            document.getElementById('naive-handlers').textContent = naiveButtons.length;
            addLog('log1', `‚ö†Ô∏è Nuovo bottone aggiunto ma SENZA gestore! (clicca per verificare)`);
        }

        // Sezione 2: Event Delegation Base
        let delegatedClicks = 0;
        let delegatedItemCount = 3;

        const delegatedContainer1 = document.getElementById('delegated-container1');
        delegatedContainer1.addEventListener('click', function(event) {
            if (event.target.classList.contains('delegated-item')) {
                delegatedClicks++;
                document.getElementById('delegated-clicks').textContent = delegatedClicks;
                addLog('log2', `‚úÖ Delegation: Item ${event.target.dataset.id} cliccato (singolo gestore sul container)`);
            }
        });

        function addDelegatedItem() {
            delegatedItemCount++;
            const item = document.createElement('div');
            item.className = 'delegated-item';
            item.dataset.id = delegatedItemCount;
            item.textContent = `üìÑ Item ${delegatedItemCount} - Clicca qui (funziona!)`;
            delegatedContainer1.appendChild(item);
            
            document.getElementById('delegated-items').textContent = 
                document.querySelectorAll('#delegated-container1 .delegated-item').length;
            addLog('log2', `‚úÖ Nuovo item aggiunto - funziona automaticamente con delegation!`);
        }

        // Sezione 3: closest()
        const delegatedContainer2 = document.getElementById('delegated-container2');
        delegatedContainer2.addEventListener('click', function(event) {
            const item = event.target.closest('.delegated-item');
            
            if (item) {
                const clickedElement = event.target.tagName.toLowerCase();
                addLog('log3', `‚úÖ closest(): Trovato item anche se hai cliccato su <${clickedElement}>`);
            }
        });

        // Sezione 4: Lista Dinamica
        let listItemCount = 0;

        const dynamicList = document.getElementById('dynamic-list');
        dynamicList.addEventListener('click', function(event) {
            if (event.target.classList.contains('delete-btn')) {
                const li = event.target.closest('li');
                const itemText = li.querySelector('span').textContent;
                li.remove();
                addLog('log4', `üóëÔ∏è Item eliminato: "${itemText}"`);
            }
        });

        function addListItem() {
            const input = document.getElementById('item-input');
            const text = input.value.trim();
            
            if (!text) {
                addLog('log4', '‚ö†Ô∏è Inserisci un testo!');
                return;
            }
            
            listItemCount++;
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${text}</span>
                <button class="delete-btn">üóëÔ∏è Elimina</button>
            `;
            dynamicList.appendChild(li);
            
            input.value = '';
            addLog('log4', `‚úÖ Item aggiunto: "${text}" (pu√≤ essere eliminato con delegation)`);
        }

        // Sezione 5: Todo List
        let todoCount = 0;

        const todoList = document.getElementById('todo-list');
        todoList.addEventListener('click', function(event) {
            const target = event.target;
            const todoItem = target.closest('.todo-item');
            
            if (!todoItem) return;
            
            const todoText = todoItem.querySelector('.todo-text').textContent;
            
            if (target.classList.contains('complete-btn')) {
                todoItem.classList.toggle('completed');
                const isCompleted = todoItem.classList.contains('completed');
                addLog('log5', `${isCompleted ? '‚úÖ' : '‚Ü©Ô∏è'} Todo "${todoText}" ${isCompleted ? 'completato' : 'ripristinato'}`);
            } else if (target.classList.contains('delete-btn')) {
                todoItem.remove();
                addLog('log5', `üóëÔ∏è Todo eliminato: "${todoText}"`);
            }
        });

        function addTodo() {
            const input = document.getElementById('todo-input');
            const text = input.value.trim();
            
            if (!text) {
                addLog('log5', '‚ö†Ô∏è Inserisci una task!');
                return;
            }
            
            todoCount++;
            const div = document.createElement('div');
            div.className = 'todo-item';
            div.innerHTML = `
                <span class="todo-text">${text}</span>
                <div>
                    <button class="complete-btn" style="background: #48bb78; padding: 6px 12px; font-size: 14px;">‚úì</button>
                    <button class="delete-btn" style="padding: 6px 12px; font-size: 14px;">üóëÔ∏è</button>
                </div>
            `;
            todoList.appendChild(div);
            
            input.value = '';
            addLog('log5', `‚úÖ Todo aggiunta: "${text}"`);
        }

        // Sezione 6: Performance Test
        function runLoopTest() {
            const start = performance.now();
            const container = document.createElement('div');
            
            // Crea 100 bottoni con gestore individuale
            for (let i = 0; i < 100; i++) {
                const btn = document.createElement('button');
                btn.textContent = `Button ${i}`;
                btn.addEventListener('click', function() {
                    console.log('Clicked', i);
                });
                container.appendChild(btn);
            }
            
            const end = performance.now();
            const time = (end - start).toFixed(2);
            
            document.getElementById('loop-result').textContent = 
                `‚è±Ô∏è Tempo: ${time}ms | 100 gestori creati`;
            addLog('log6', `‚ùå Loop: ${time}ms per 100 gestori (alta memoria)`);
        }

        function runDelegationTest() {
            const start = performance.now();
            const container = document.createElement('div');
            
            // Crea 100 bottoni con UN solo gestore
            for (let i = 0; i < 100; i++) {
                const btn = document.createElement('button');
                btn.textContent = `Button ${i}`;
                btn.dataset.index = i;
                container.appendChild(btn);
            }
            
            // Un solo gestore sul container
            container.addEventListener('click', function(event) {
                if (event.target.matches('button')) {
                    console.log('Clicked', event.target.dataset.index);
                }
            });
            
            const end = performance.now();
            const time = (end - start).toFixed(2);
            
            document.getElementById('delegation-result').textContent = 
                `‚è±Ô∏è Tempo: ${time}ms | 1 gestore creato`;
            addLog('log6', `‚úÖ Delegation: ${time}ms per 1 gestore (bassa memoria)`);
        }

        // Log iniziali
        addLog('log1', 'üìã Demo approccio na√Øve pronta (forEach con gestori individuali)');
        addLog('log2', 'üìã Demo event delegation pronta (gestore sul contenitore)');
        addLog('log3', 'üìã Demo closest() pronta (trova antenato pi√π vicino)');
        addLog('log4', 'üìã Demo lista dinamica pronta (aggiungi/elimina)');
        addLog('log5', 'üìã Demo todo list pronta (completa/elimina)');
        addLog('log6', 'üìã Demo confronto performance pronta');
    </script>
</body>
</html>
