<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05.02 - Event Delegation Avanzata</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .section h2 {
            color: #f5576c;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f5576c;
        }

        .demo-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }

        button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        button.edit {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }

        button.delete {
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
        }

        button.view {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .log {
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            max-height: 250px;
            overflow-y: auto;
            font-size: 13px;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #48bb78;
            padding-left: 10px;
        }

        .log-entry.performance {
            border-left-color: #f6ad55;
            color: #f6ad55;
        }

        .log-entry.action {
            border-left-color: #4299e1;
            color: #4299e1;
        }

        .code-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #f5576c;
        }

        .stat-label {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }

        .todo-item, .product-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .todo-item:hover, .product-card:hover {
            border-color: #f5576c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.2);
        }

        .todo-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .product-card {
            flex-direction: column;
            align-items: flex-start;
            cursor: pointer;
        }

        .product-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 24px;
            font-weight: bold;
            color: #f5576c;
            margin: 10px 0;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            margin: 5px 0;
        }

        input:focus {
            outline: none;
            border-color: #f5576c;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        .comparison-item h4 {
            color: #f5576c;
            margin-bottom: 15px;
        }

        .tag {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }

        .tag.priority-high {
            background: #fed7d7;
            color: #742a2a;
        }

        .tag.priority-medium {
            background: #feebc8;
            color: #744210;
        }

        .tag.priority-low {
            background: #c6f6d5;
            color: #22543d;
        }

        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }
            
            .product-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ 05.02 - Event Delegation Avanzata</h1>

        <!-- Sezione 1: delegateEvent Helper -->
        <div class="section">
            <h2>1. Funzione delegateEvent con closest()</h2>
            <p>Helper per delegation su selettori multipli.</p>
            
            <div class="demo-area">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="delegated-events">0</div>
                        <div class="stat-label">Eventi Delegati</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="listeners-saved">0</div>
                        <div class="stat-label">Listener Risparmiati</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="memory-saved">0</div>
                        <div class="stat-label">KB Memoria Risparmiata</div>
                    </div>
                </div>
                
                <div class="code-display">
// Implementazione delegateEvent
function delegateEvent(parent, eventType, selector, handler) {
    parent.addEventListener(eventType, (event) => {
        const target = event.target.closest(selector);
        
        if (target && parent.contains(target)) {
            // Chiama handler con target corretto
            handler.call(target, event, target);
        }
    });
}

// Utilizzo: un solo listener per tutti i bottoni
delegateEvent(document.body, 'click', 'button', (event, button) => {
    console.log('Bottone cliccato:', button);
});

// Vantaggi:
// ‚úÖ Un solo event listener invece di N listeners
// ‚úÖ Funziona con elementi aggiunti dinamicamente
// ‚úÖ Meno memoria occupata
// ‚úÖ Migliore performance</div>
            </div>
            <div id="log1" class="log"></div>
        </div>

        <!-- Sezione 2: Pattern data-action -->
        <div class="section">
            <h2>2. Pattern data-action per Routing</h2>
            <p>Gestione centralizzata delle azioni con attributi data-*.</p>
            
            <div class="demo-area">
                <h4>üìù Todo List (con data-action):</h4>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="new-todo" placeholder="Nuova attivit√†...">
                    <button data-action="add-todo">‚ûï Aggiungi</button>
                </div>
                
                <div id="todo-list">
                    <div class="todo-item" data-id="1">
                        <div>
                            <strong>Completare progetto JavaScript</strong>
                            <div style="font-size: 12px; color: #718096;">Scadenza: Domani</div>
                            <span class="tag priority-high">Alta priorit√†</span>
                        </div>
                        <div>
                            <button data-action="toggle" data-id="1" class="view">‚úì</button>
                            <button data-action="edit" data-id="1" class="edit">‚úèÔ∏è</button>
                            <button data-action="delete" data-id="1" class="delete">üóëÔ∏è</button>
                        </div>
                    </div>
                    
                    <div class="todo-item" data-id="2">
                        <div>
                            <strong>Studiare event delegation</strong>
                            <div style="font-size: 12px; color: #718096;">Scadenza: 5 giorni</div>
                            <span class="tag priority-medium">Media priorit√†</span>
                        </div>
                        <div>
                            <button data-action="toggle" data-id="2" class="view">‚úì</button>
                            <button data-action="edit" data-id="2" class="edit">‚úèÔ∏è</button>
                            <button data-action="delete" data-id="2" class="delete">üóëÔ∏è</button>
                        </div>
                    </div>
                    
                    <div class="todo-item" data-id="3">
                        <div>
                            <strong>Rivedere esempi pratici</strong>
                            <div style="font-size: 12px; color: #718096;">Scadenza: 1 settimana</div>
                            <span class="tag priority-low">Bassa priorit√†</span>
                        </div>
                        <div>
                            <button data-action="toggle" data-id="3" class="view">‚úì</button>
                            <button data-action="edit" data-id="3" class="edit">‚úèÔ∏è</button>
                            <button data-action="delete" data-id="3" class="delete">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
                
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value" id="todo-count">3</div>
                        <div class="stat-label">Todo Attive</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completed-count">0</div>
                        <div class="stat-label">Completate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="actions-count">0</div>
                        <div class="stat-label">Azioni Eseguite</div>
                    </div>
                </div>
                
                <div class="code-display">
// Pattern data-action con action router
const actionHandlers = {
    'add-todo': (event, element) => {
        const input = document.querySelector('#new-todo');
        addTodo(input.value);
        input.value = '';
    },
    
    'edit': (event, element) => {
        const id = element.dataset.id;
        editTodo(id);
    },
    
    'delete': (event, element) => {
        const id = element.dataset.id;
        deleteTodo(id);
    },
    
    'toggle': (event, element) => {
        const id = element.dataset.id;
        toggleTodo(id);
    }
};

// Un solo event listener per tutte le azioni
document.addEventListener('click', (event) => {
    const action = event.target.dataset.action;
    
    if (action && actionHandlers[action]) {
        actionHandlers[action](event, event.target);
    }
});</div>
            </div>
            <div id="log2" class="log"></div>
        </div>

        <!-- Sezione 3: Confronto Performance -->
        <div class="section">
            <h2>3. Confronto: Delegation vs Listener Individuali</h2>
            <p>Test di performance con elementi dinamici.</p>
            
            <div class="demo-area">
                <div class="comparison">
                    <div class="comparison-item">
                        <h4>‚ùå Senza Delegation (Lento)</h4>
                        <p style="color: #718096; font-size: 14px; margin-bottom: 15px;">
                            Ogni elemento ha il proprio listener
                        </p>
                        <button onclick="addItemsWithoutDelegation()">Aggiungi 50 elementi</button>
                        <button onclick="clearWithoutDelegation()" class="delete">Pulisci</button>
                        <div id="list-without-delegation" style="margin-top: 15px; max-height: 200px; overflow-y: auto;"></div>
                        <div style="margin-top: 10px;">
                            <strong>Tempo:</strong> <span id="time-without">-</span><br>
                            <strong>Listeners:</strong> <span id="listeners-without">0</span>
                        </div>
                    </div>
                    
                    <div class="comparison-item">
                        <h4>‚úÖ Con Delegation (Veloce)</h4>
                        <p style="color: #718096; font-size: 14px; margin-bottom: 15px;">
                            Un solo listener sul contenitore
                        </p>
                        <button onclick="addItemsWithDelegation()">Aggiungi 50 elementi</button>
                        <button onclick="clearWithDelegation()" class="delete">Pulisci</button>
                        <div id="list-with-delegation" style="margin-top: 15px; max-height: 200px; overflow-y: auto;"></div>
                        <div style="margin-top: 10px;">
                            <strong>Tempo:</strong> <span id="time-with">-</span><br>
                            <strong>Listeners:</strong> <span id="listeners-with">1</span>
                        </div>
                    </div>
                </div>
                
                <div class="code-display">
// ‚ùå MALE: Listener individuali (non scalabile)
items.forEach(item => {
    const button = document.createElement('button');
    button.addEventListener('click', () => {
        handleClick(item);
    });
    // N elementi = N listeners = üò±
});

// ‚úÖ BENE: Event delegation (scalabile)
container.addEventListener('click', (event) => {
    if (event.target.matches('button')) {
        const id = event.target.dataset.id;
        handleClick(id);
    }
    // 1000 elementi = 1 listener = üòä
});

// Vantaggi delegation:
// ‚Ä¢ Meno memoria (1 listener vs N listeners)
// ‚Ä¢ Pi√π veloce (meno event handler da registrare)
// ‚Ä¢ Elementi dinamici gestiti automaticamente
// ‚Ä¢ Codice pi√π pulito e manutenibile</div>
            </div>
            <div id="log3" class="log"></div>
        </div>

        <!-- Sezione 4: Dynamic Product Grid -->
        <div class="section">
            <h2>4. Product Grid Dinamico</h2>
            <p>Gestione click su griglia prodotti con delegation.</p>
            
            <div class="demo-area">
                <div style="margin-bottom: 15px;">
                    <button onclick="addRandomProducts(5)">‚ûï Aggiungi 5 Prodotti</button>
                    <button onclick="clearProducts()" class="delete">üóëÔ∏è Rimuovi Tutti</button>
                </div>
                
                <div id="product-grid" class="product-grid">
                    <!-- Prodotti generati dinamicamente -->
                </div>
                
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value" id="products-count">0</div>
                        <div class="stat-label">Prodotti</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="products-clicked">0</div>
                        <div class="stat-label">Click Prodotti</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="buttons-clicked">0</div>
                        <div class="stat-label">Click Bottoni</div>
                    </div>
                </div>
                
                <div class="code-display">
// Delegation su griglia dinamica
const productGrid = document.getElementById('product-grid');

// Un solo listener gestisce tutto
productGrid.addEventListener('click', (event) => {
    // Click su card prodotto
    const card = event.target.closest('.product-card');
    if (card) {
        const id = card.dataset.id;
        showProductDetails(id);
        return;
    }
    
    // Click su bottone "Aggiungi al carrello"
    if (event.target.matches('[data-action="add-to-cart"]')) {
        event.stopPropagation(); // Non attiva click su card
        const id = event.target.dataset.id;
        addToCart(id);
        return;
    }
    
    // Click su bottone "Preferiti"
    if (event.target.matches('[data-action="add-to-favorites"]')) {
        event.stopPropagation();
        const id = event.target.dataset.id;
        addToFavorites(id);
    }
});

// Nuovi prodotti aggiunti? Funzionano subito! ‚ú®</div>
            </div>
            <div id="log4" class="log"></div>
        </div>

    </div>

    <script>
        // Utility logging
        function addLog(logId, message, type = 'info') {
            const log = document.getElementById(logId);
            if (!log) return;
            
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
            
            if (log.children.length > 50) {
                log.removeChild(log.firstChild);
            }
        }

        // delegateEvent implementation
        function delegateEvent(parent, eventType, selector, handler) {
            parent.addEventListener(eventType, (event) => {
                const target = event.target.closest(selector);
                
                if (target && parent.contains(target)) {
                    handler.call(target, event, target);
                }
            });
            
            updateDelegationStats();
        }

        let delegatedEventsCount = 0;
        let elementsManaged = 0;

        function updateDelegationStats() {
            delegatedEventsCount++;
            elementsManaged = document.querySelectorAll('button, .todo-item, .product-card').length;
            
            const listenersSaved = Math.max(0, elementsManaged - delegatedEventsCount);
            const memorySaved = Math.floor(listenersSaved * 0.5); // ~0.5KB per listener
            
            document.getElementById('delegated-events').textContent = delegatedEventsCount;
            document.getElementById('listeners-saved').textContent = listenersSaved;
            document.getElementById('memory-saved').textContent = memorySaved;
        }

        // Sezione 2: Todo List con data-action
        let todoIdCounter = 4;
        let actionsCount = 0;
        let completedCount = 0;

        const actionHandlers = {
            'add-todo': (event, element) => {
                const input = document.getElementById('new-todo');
                const text = input.value.trim();
                
                if (!text) return;
                
                addTodo(text);
                input.value = '';
                actionsCount++;
                updateTodoStats();
            },
            
            'edit': (event, element) => {
                const id = element.dataset.id;
                const newText = prompt('Modifica attivit√†:');
                if (newText) {
                    editTodo(id, newText);
                    actionsCount++;
                    updateTodoStats();
                }
            },
            
            'delete': (event, element) => {
                const id = element.dataset.id;
                deleteTodo(id);
                actionsCount++;
                updateTodoStats();
            },
            
            'toggle': (event, element) => {
                const id = element.dataset.id;
                toggleTodo(id);
                actionsCount++;
                updateTodoStats();
            }
        };

        // Delegation per todo actions
        document.addEventListener('click', (event) => {
            const action = event.target.dataset.action;
            
            if (action && actionHandlers[action]) {
                addLog('log2', `üéØ Azione: ${action}`, 'action');
                actionHandlers[action](event, event.target);
            }
        });

        function addTodo(text) {
            const todoList = document.getElementById('todo-list');
            const id = todoIdCounter++;
            
            const div = document.createElement('div');
            div.className = 'todo-item';
            div.dataset.id = id;
            div.innerHTML = `
                <div>
                    <strong>${text}</strong>
                    <div style="font-size: 12px; color: #718096;">Aggiunta ora</div>
                    <span class="tag priority-low">Bassa priorit√†</span>
                </div>
                <div>
                    <button data-action="toggle" data-id="${id}" class="view">‚úì</button>
                    <button data-action="edit" data-id="${id}" class="edit">‚úèÔ∏è</button>
                    <button data-action="delete" data-id="${id}" class="delete">üóëÔ∏è</button>
                </div>
            `;
            
            todoList.appendChild(div);
            addLog('log2', `‚ûï Aggiunto: "${text}"`);
        }

        function editTodo(id, newText) {
            const item = document.querySelector(`.todo-item[data-id="${id}"]`);
            if (item) {
                item.querySelector('strong').textContent = newText;
                addLog('log2', `‚úèÔ∏è Modificato todo #${id}`);
            }
        }

        function deleteTodo(id) {
            const item = document.querySelector(`.todo-item[data-id="${id}"]`);
            if (item) {
                if (item.classList.contains('completed')) {
                    completedCount--;
                }
                item.remove();
                addLog('log2', `üóëÔ∏è Eliminato todo #${id}`);
            }
        }

        function toggleTodo(id) {
            const item = document.querySelector(`.todo-item[data-id="${id}"]`);
            if (item) {
                item.classList.toggle('completed');
                if (item.classList.contains('completed')) {
                    completedCount++;
                    addLog('log2', `‚úì Completato todo #${id}`);
                } else {
                    completedCount--;
                    addLog('log2', `‚Ü©Ô∏è Riattivato todo #${id}`);
                }
            }
        }

        function updateTodoStats() {
            const todoCount = document.querySelectorAll('.todo-item:not(.completed)').length;
            document.getElementById('todo-count').textContent = todoCount;
            document.getElementById('completed-count').textContent = completedCount;
            document.getElementById('actions-count').textContent = actionsCount;
            updateDelegationStats();
        }

        updateTodoStats();
        addLog('log2', 'üí° Un solo event listener gestisce TUTTE le azioni');

        // Sezione 3: Performance Comparison
        let listenersWithoutDelegation = 0;

        function addItemsWithoutDelegation() {
            const container = document.getElementById('list-without-delegation');
            const start = performance.now();
            
            for (let i = 0; i < 50; i++) {
                const button = document.createElement('button');
                button.textContent = `Elemento ${i + 1}`;
                button.style.cssText = 'margin: 5px; padding: 10px;';
                
                // Listener individuale per ogni elemento
                button.addEventListener('click', function() {
                    addLog('log3', `Click su elemento ${i + 1}`, 'action');
                });
                
                container.appendChild(button);
                listenersWithoutDelegation++;
            }
            
            const end = performance.now();
            const time = (end - start).toFixed(2);
            
            document.getElementById('time-without').textContent = `${time}ms`;
            document.getElementById('listeners-without').textContent = listenersWithoutDelegation;
            
            addLog('log3', `‚ùå Senza delegation: ${time}ms, ${listenersWithoutDelegation} listeners`, 'performance');
        }

        function clearWithoutDelegation() {
            document.getElementById('list-without-delegation').innerHTML = '';
            listenersWithoutDelegation = 0;
            document.getElementById('listeners-without').textContent = '0';
            document.getElementById('time-without').textContent = '-';
        }

        // Con delegation
        const listWithDelegation = document.getElementById('list-with-delegation');
        let delegationItemCount = 0;

        listWithDelegation.addEventListener('click', (event) => {
            if (event.target.matches('button')) {
                const text = event.target.textContent;
                addLog('log3', `Click su ${text}`, 'action');
            }
        });

        function addItemsWithDelegation() {
            const container = listWithDelegation;
            const start = performance.now();
            
            for (let i = 0; i < 50; i++) {
                const button = document.createElement('button');
                button.textContent = `Elemento ${i + 1}`;
                button.style.cssText = 'margin: 5px; padding: 10px;';
                container.appendChild(button);
                delegationItemCount++;
            }
            
            const end = performance.now();
            const time = (end - start).toFixed(2);
            
            document.getElementById('time-with').textContent = `${time}ms`;
            
            addLog('log3', `‚úÖ Con delegation: ${time}ms, 1 listener per ${delegationItemCount} elementi!`, 'performance');
        }

        function clearWithDelegation() {
            listWithDelegation.innerHTML = '';
            delegationItemCount = 0;
            document.getElementById('time-with').textContent = '-';
        }

        addLog('log3', 'üí° Prova ad aggiungere 50 elementi e confronta i tempi!');

        // Sezione 4: Product Grid
        let productIdCounter = 1;
        let productsClickedCount = 0;
        let buttonsClickedCount = 0;

        const productNames = [
            'üéß Cuffie Premium', '‚åö Smartwatch Pro', 'üì± Smartphone X',
            'üíª Laptop Ultra', 'üñ±Ô∏è Mouse Gaming', '‚å®Ô∏è Tastiera RGB',
            'üì∑ Fotocamera 4K', 'üéÆ Console Next-Gen', 'üîä Speaker Bluetooth'
        ];

        const productGrid = document.getElementById('product-grid');

        // Delegation su product grid
        productGrid.addEventListener('click', (event) => {
            // Click su card prodotto
            const card = event.target.closest('.product-card');
            if (card && !event.target.matches('button')) {
                const id = card.dataset.id;
                const name = card.querySelector('strong').textContent;
                productsClickedCount++;
                updateProductStats();
                addLog('log4', `üëÅÔ∏è Visualizzato: ${name}`);
                return;
            }
            
            // Click su bottone "Aggiungi al carrello"
            if (event.target.matches('[data-action="add-to-cart"]')) {
                event.stopPropagation();
                const id = event.target.dataset.id;
                buttonsClickedCount++;
                updateProductStats();
                addLog('log4', `üõí Aggiunto al carrello prodotto #${id}`);
                return;
            }
            
            // Click su bottone "Preferiti"
            if (event.target.matches('[data-action="add-to-favorites"]')) {
                event.stopPropagation();
                const id = event.target.dataset.id;
                buttonsClickedCount++;
                updateProductStats();
                addLog('log4', `‚ù§Ô∏è Aggiunto ai preferiti prodotto #${id}`);
            }
        });

        function addRandomProducts(count) {
            for (let i = 0; i < count; i++) {
                const id = productIdCounter++;
                const name = productNames[Math.floor(Math.random() * productNames.length)];
                const price = (Math.random() * 200 + 50).toFixed(2);
                
                const card = document.createElement('div');
                card.className = 'product-card';
                card.dataset.id = id;
                card.innerHTML = `
                    <div style="width: 100%; height: 150px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 6px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; font-size: 48px;">
                        ${name.split(' ')[0]}
                    </div>
                    <strong>${name}</strong>
                    <div class="product-price">‚Ç¨${price}</div>
                    <button data-action="add-to-cart" data-id="${id}" style="width: 100%; margin: 5px 0;">üõí Carrello</button>
                    <button data-action="add-to-favorites" data-id="${id}" class="edit" style="width: 100%; margin: 0;">‚ù§Ô∏è Preferiti</button>
                `;
                
                productGrid.appendChild(card);
            }
            
            updateProductStats();
            addLog('log4', `‚ûï Aggiunti ${count} prodotti (delegation attiva automaticamente)`);
        }

        function clearProducts() {
            productGrid.innerHTML = '';
            productIdCounter = 1;
            updateProductStats();
            addLog('log4', 'üóëÔ∏è Tutti i prodotti rimossi');
        }

        function updateProductStats() {
            const count = document.querySelectorAll('.product-card').length;
            document.getElementById('products-count').textContent = count;
            document.getElementById('products-clicked').textContent = productsClickedCount;
            document.getElementById('buttons-clicked').textContent = buttonsClickedCount;
            updateDelegationStats();
        }

        // Inizializzazione
        addRandomProducts(6);
        addLog('log4', 'üí° Delegation permette di gestire elementi dinamici senza aggiungere listener');
        addLog('log1', 'üí° Event delegation usa closest() per trovare il target corretto');
        addLog('log1', '   Funziona anche se si clicca su elementi interni (es. icone nei bottoni)');
    </script>
</body>
</html>
