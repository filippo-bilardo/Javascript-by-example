<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05.04 - Custom Events e Component System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .section h2 {
            color: #a8edea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #a8edea;
        }

        .demo-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }

        button {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #2d3748;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 237, 234, 0.4);
        }

        .log {
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            max-height: 250px;
            overflow-y: auto;
            font-size: 13px;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #48bb78;
            padding-left: 10px;
        }

        .log-entry.component {
            border-left-color: #4299e1;
            color: #4299e1;
        }

        .log-entry.event {
            border-left-color: #f6ad55;
            color: #f6ad55;
        }

        .code-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #a8edea;
        }

        .stat-label {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }

        .component-demo {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .component-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .component-sidebar {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .component-content {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 20px;
            border-radius: 6px;
            min-height: 200px;
        }

        .cart-item {
            background: #f7fafc;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #a8edea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-total {
            background: #2d3748;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 20px;
            font-weight: bold;
            text-align: right;
        }

        .event-flow {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #e2e8f0;
        }

        .event-flow-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid;
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .product-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            margin: 10px 0;
            transition: all 0.3s;
        }

        .product-card:hover {
            border-color: #a8edea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 237, 234, 0.2);
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            margin: 5px 0;
        }

        input:focus {
            outline: none;
            border-color: #a8edea;
        }

        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }

        .notification {
            background: white;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            border-left-color: #48bb78;
        }

        .notification.error {
            border-left-color: #f56565;
        }

        .notification.info {
            border-left-color: #4299e1;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≠ 05.04 - Custom Events e Component System</h1>

        <!-- Sezione 1: CustomEvent Base -->
        <div class="section">
            <h2>1. CustomEvent con detail</h2>
            <p>Eventi personalizzati con dati complessi.</p>
            
            <div class="demo-area">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="custom-events-fired">0</div>
                        <div class="stat-label">Custom Events Fired</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="listeners-active">0</div>
                        <div class="stat-label">Listeners Attivi</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="data-passed">0</div>
                        <div class="stat-label">KB Dati Passati</div>
                    </div>
                </div>
                
                <button onclick="fireUserEvent()">üë§ Fire userLoggedIn Event</button>
                <button onclick="fireDataEvent()">üìä Fire dataUpdated Event</button>
                <button onclick="fireComplexEvent()">üéØ Fire Complex Event</button>
                
                <div class="code-display">
// Creare Custom Event con detail
const event = new CustomEvent('userLoggedIn', {
    detail: {
        userId: 123,
        username: 'mario',
        timestamp: Date.now(),
        permissions: ['read', 'write']
    },
    bubbles: true,      // Event bubbles up
    cancelable: true,   // Can be preventDefault()
    composed: false     // Won't cross shadow DOM boundary
});

// Dispatch l'evento
element.dispatchEvent(event);

// Ascoltare l'evento
element.addEventListener('userLoggedIn', (e) => {
    console.log('User:', e.detail.username);
    console.log('Permissions:', e.detail.permissions);
    // Accesso a TUTTI i dati tramite e.detail
});</div>

                <div class="event-flow" id="event-flow">
                    <h4>Event Flow Log:</h4>
                </div>
            </div>
            <div id="log1" class="log"></div>
        </div>

        <!-- Sezione 2: EventTarget Extension -->
        <div class="section">
            <h2>2. Classe con EventTarget (Shopping Cart)</h2>
            <p>Estendere EventTarget per creare classi event-driven.</p>
            
            <div class="demo-area">
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <div>
                        <h4>üõçÔ∏è Prodotti:</h4>
                        <div class="product-card">
                            <h5>üéß Cuffie Wireless Premium</h5>
                            <p style="font-size: 24px; color: #a8edea; font-weight: bold;">‚Ç¨79.99</p>
                            <button onclick="cartAddItem('headphones', 'Cuffie Wireless Premium', 79.99)">
                                ‚ûï Aggiungi al carrello
                            </button>
                        </div>
                        
                        <div class="product-card">
                            <h5>‚å®Ô∏è Tastiera Meccanica RGB</h5>
                            <p style="font-size: 24px; color: #a8edea; font-weight: bold;">‚Ç¨129.99</p>
                            <button onclick="cartAddItem('keyboard', 'Tastiera Meccanica RGB', 129.99)">
                                ‚ûï Aggiungi al carrello
                            </button>
                        </div>
                        
                        <div class="product-card">
                            <h5>üñ±Ô∏è Mouse Gaming Pro</h5>
                            <p style="font-size: 24px; color: #a8edea; font-weight: bold;">‚Ç¨49.99</p>
                            <button onclick="cartAddItem('mouse', 'Mouse Gaming Pro', 49.99)">
                                ‚ûï Aggiungi al carrello
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <div style="background: white; padding: 20px; border-radius: 8px; border: 2px solid #e2e8f0;">
                            <h4>üõí Carrello</h4>
                            <div id="cart-items-display"></div>
                            <div class="cart-total">
                                Totale: ‚Ç¨<span id="cart-total-display">0.00</span>
                            </div>
                            <button onclick="cartClear()" style="width: 100%; margin-top: 15px; background: linear-gradient(135deg, #f56565 0%, #c53030 100%);">
                                üóëÔ∏è Svuota Carrello
                            </button>
                            <button onclick="cartCheckout()" style="width: 100%; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">
                                üí≥ Checkout
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value" id="items-in-cart">0</div>
                        <div class="stat-label">Articoli nel Carrello</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="items-added-count">0</div>
                        <div class="stat-label">Aggiunte Totali</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="items-removed-count">0</div>
                        <div class="stat-label">Rimozioni Totali</div>
                    </div>
                </div>
                
                <div class="code-display">
// Classe che estende EventTarget
class ShoppingCart extends EventTarget {
    constructor() {
        super();
        this.items = [];
    }
    
    addItem(item) {
        this.items.push(item);
        
        // Dispatch custom event
        this.dispatchEvent(new CustomEvent('itemAdded', {
            detail: {
                item,
                cartSize: this.items.length,
                total: this.getTotal()
            }
        }));
    }
    
    removeItem(itemId) {
        const index = this.items.findIndex(i => i.id === itemId);
        if (index !== -1) {
            const removed = this.items.splice(index, 1)[0];
            
            this.dispatchEvent(new CustomEvent('itemRemoved', {
                detail: {
                    item: removed,
                    cartSize: this.items.length,
                    total: this.getTotal()
                }
            }));
        }
    }
    
    getTotal() {
        return this.items.reduce((sum, item) => sum + item.price, 0);
    }
}

// Utilizzo
const cart = new ShoppingCart();

cart.addEventListener('itemAdded', (e) => {
    console.log('Item added:', e.detail.item);
    updateUI(e.detail.cartSize);
});

cart.addEventListener('itemRemoved', (e) => {
    console.log('Item removed:', e.detail.item);
    updateUI(e.detail.cartSize);
});</div>
            </div>
            <div id="log2" class="log"></div>
        </div>

        <!-- Sezione 3: Component System -->
        <div class="section">
            <h2>3. Sistema di Componenti Comunicanti</h2>
            <p>Componenti che comunicano tramite eventi personalizzati.</p>
            
            <div class="demo-area">
                <div class="component-demo" id="app-component">
                    <div class="component-header">
                        <div>
                            <strong>üì± App Component</strong>
                            <div style="font-size: 12px; opacity: 0.8;">User: <span id="header-username">Not logged in</span></div>
                        </div>
                        <div>
                            <button onclick="componentLogin()" style="background: white; color: #667eea;">
                                üîê Login
                            </button>
                            <button onclick="componentLogout()" style="background: white; color: #667eea;">
                                üö™ Logout
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 250px 1fr; gap: 15px;">
                        <div class="component-sidebar" id="sidebar-component">
                            <h4>üìã Sidebar Component</h4>
                            <div id="sidebar-content">
                                <p style="font-size: 14px; opacity: 0.8;">Login to see menu</p>
                            </div>
                        </div>
                        
                        <div class="component-content" id="content-component">
                            <h4>üìÑ Content Component</h4>
                            <div id="content-display">
                                <p>Welcome! Please login to access content.</p>
                            </div>
                            <button onclick="componentLoadData()" style="background: white; color: #43e97b; margin-top: 15px;">
                                üìä Load Data
                            </button>
                            <button onclick="componentRefresh()" style="background: white; color: #43e97b;">
                                üîÑ Refresh
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value" id="component-events">0</div>
                        <div class="stat-label">Eventi tra Componenti</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="component-updates">0</div>
                        <div class="stat-label">Updates UI</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="data-loads">0</div>
                        <div class="stat-label">Caricamenti Dati</div>
                    </div>
                </div>
                
                <div class="code-display">
// Component System con Eventi
class Component extends EventTarget {
    constructor(name) {
        super();
        this.name = name;
    }
    
    // Emit event to other components
    emit(eventName, data) {
        this.dispatchEvent(new CustomEvent(eventName, {
            detail: { source: this.name, data },
            bubbles: true
        }));
    }
}

// Header Component
class HeaderComponent extends Component {
    login(user) {
        this.emit('userLoggedIn', user);
    }
    
    logout() {
        this.emit('userLoggedOut', {});
    }
}

// Sidebar Component
class SidebarComponent extends Component {
    constructor() {
        super('Sidebar');
        
        // Listen to Header events
        document.addEventListener('userLoggedIn', (e) => {
            this.showMenu(e.detail.data);
        });
        
        document.addEventListener('userLoggedOut', () => {
            this.hideMenu();
        });
    }
}

// Content Component
class ContentComponent extends Component {
    constructor() {
        super('Content');
        
        // Listen to Header events
        document.addEventListener('userLoggedIn', (e) => {
            this.loadContent(e.detail.data);
        });
    }
}

// Tutti i componenti comunicano senza conoscersi direttamente! ‚ú®</div>
            </div>
            <div id="log3" class="log"></div>
        </div>

    </div>

    <div class="notification-container" id="notifications"></div>

    <script>
        // Utility logging
        function addLog(logId, message, type = 'info') {
            const log = document.getElementById(logId);
            if (!log) return;
            
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
            
            if (log.children.length > 50) {
                log.removeChild(log.firstChild);
            }
        }

        // Notification System
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.textContent = message;
            container.appendChild(notif);
            
            setTimeout(() => {
                notif.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        // Sezione 1: CustomEvent Base
        let customEventsFired = 0;
        let listenersActive = 3;
        let dataPassed = 0;

        // Setup listeners
        document.addEventListener('userLoggedIn', (e) => {
            addLog('log1', `Listener1: User ${e.detail.username} logged in`, 'event');
            addEventFlow('userLoggedIn', e.detail);
        });

        document.addEventListener('dataUpdated', (e) => {
            addLog('log1', `Listener2: Data updated (${e.detail.recordCount} records)`, 'event');
            addEventFlow('dataUpdated', e.detail);
        });

        document.addEventListener('complexEvent', (e) => {
            addLog('log1', `Listener3: Complex event received with ${Object.keys(e.detail).length} properties`, 'event');
            addEventFlow('complexEvent', e.detail);
        });

        function fireUserEvent() {
            const event = new CustomEvent('userLoggedIn', {
                detail: {
                    userId: 123,
                    username: 'mario.rossi',
                    email: 'mario@example.com',
                    timestamp: Date.now(),
                    permissions: ['read', 'write', 'delete']
                },
                bubbles: true
            });
            
            document.dispatchEvent(event);
            customEventsFired++;
            dataPassed += 0.5;
            updateCustomStats();
            showNotification('userLoggedIn event fired!', 'success');
        }

        function fireDataEvent() {
            const event = new CustomEvent('dataUpdated', {
                detail: {
                    recordCount: Math.floor(Math.random() * 100) + 1,
                    source: 'API',
                    timestamp: Date.now(),
                    changes: ['insert', 'update', 'delete']
                },
                bubbles: true
            });
            
            document.dispatchEvent(event);
            customEventsFired++;
            dataPassed += 0.3;
            updateCustomStats();
            showNotification('dataUpdated event fired!', 'info');
        }

        function fireComplexEvent() {
            const event = new CustomEvent('complexEvent', {
                detail: {
                    id: Math.random().toString(36).substr(2, 9),
                    type: 'transaction',
                    payload: {
                        amount: 149.99,
                        currency: 'EUR',
                        items: ['item1', 'item2', 'item3']
                    },
                    metadata: {
                        ip: '192.168.1.1',
                        userAgent: navigator.userAgent.substring(0, 50),
                        timestamp: Date.now()
                    },
                    status: 'completed'
                },
                bubbles: true,
                cancelable: true
            });
            
            document.dispatchEvent(event);
            customEventsFired++;
            dataPassed += 1.2;
            updateCustomStats();
            showNotification('Complex event fired!', 'success');
        }

        function updateCustomStats() {
            document.getElementById('custom-events-fired').textContent = customEventsFired;
            document.getElementById('listeners-active').textContent = listenersActive;
            document.getElementById('data-passed').textContent = dataPassed.toFixed(1);
        }

        function addEventFlow(eventName, detail) {
            const flow = document.getElementById('event-flow');
            const item = document.createElement('div');
            item.className = 'event-flow-item';
            item.style.borderLeftColor = eventName === 'userLoggedIn' ? '#4299e1' : 
                                          eventName === 'dataUpdated' ? '#48bb78' : '#f6ad55';
            item.innerHTML = `
                <strong>${eventName}</strong>
                <pre style="margin: 5px 0; font-size: 12px; color: #718096;">${JSON.stringify(detail, null, 2).substring(0, 200)}...</pre>
            `;
            flow.appendChild(item);
            
            if (flow.children.length > 6) {
                flow.removeChild(flow.children[1]);
            }
        }

        addLog('log1', 'üí° CustomEvent permette di passare dati complessi tramite detail');

        // Sezione 2: Shopping Cart
        class ShoppingCart extends EventTarget {
            constructor() {
                super();
                this.items = [];
            }
            
            addItem(item) {
                this.items.push(item);
                
                this.dispatchEvent(new CustomEvent('itemAdded', {
                    detail: {
                        item,
                        cartSize: this.items.length,
                        total: this.getTotal()
                    }
                }));
            }
            
            removeItem(itemId) {
                const index = this.items.findIndex(i => i.id === itemId);
                if (index !== -1) {
                    const removed = this.items.splice(index, 1)[0];
                    
                    this.dispatchEvent(new CustomEvent('itemRemoved', {
                        detail: {
                            item: removed,
                            cartSize: this.items.length,
                            total: this.getTotal()
                        }
                    }));
                }
            }
            
            clear() {
                this.items = [];
                
                this.dispatchEvent(new CustomEvent('cartCleared', {
                    detail: { timestamp: Date.now() }
                }));
            }
            
            checkout() {
                const total = this.getTotal();
                const items = [...this.items];
                
                this.dispatchEvent(new CustomEvent('checkoutStarted', {
                    detail: { items, total, itemCount: items.length }
                }));
                
                this.items = [];
                
                this.dispatchEvent(new CustomEvent('checkoutCompleted', {
                    detail: { total, timestamp: Date.now() }
                }));
            }
            
            getTotal() {
                return this.items.reduce((sum, item) => sum + item.price, 0);
            }
        }

        const cart = new ShoppingCart();
        let itemsAddedCount = 0;
        let itemsRemovedCount = 0;

        cart.addEventListener('itemAdded', (e) => {
            addLog('log2', `üõí Item Added: ${e.detail.item.name} - ‚Ç¨${e.detail.item.price}`, 'event');
            itemsAddedCount++;
            updateCartDisplay();
            updateCartStats();
            showNotification(`${e.detail.item.name} aggiunto al carrello!`, 'success');
        });

        cart.addEventListener('itemRemoved', (e) => {
            addLog('log2', `üóëÔ∏è Item Removed: ${e.detail.item.name}`, 'event');
            itemsRemovedCount++;
            updateCartDisplay();
            updateCartStats();
            showNotification(`${e.detail.item.name} rimosso dal carrello`, 'error');
        });

        cart.addEventListener('cartCleared', () => {
            addLog('log2', 'üóëÔ∏è Cart Cleared', 'event');
            updateCartDisplay();
            updateCartStats();
            showNotification('Carrello svuotato', 'info');
        });

        cart.addEventListener('checkoutCompleted', (e) => {
            addLog('log2', `üí≥ Checkout Completed: ‚Ç¨${e.detail.total.toFixed(2)}`, 'event');
            updateCartDisplay();
            updateCartStats();
            showNotification(`Checkout completato: ‚Ç¨${e.detail.total.toFixed(2)}`, 'success');
        });

        function cartAddItem(id, name, price) {
            cart.addItem({ id, name, price });
        }

        function cartRemoveItem(id) {
            cart.removeItem(id);
        }

        function cartClear() {
            cart.clear();
        }

        function cartCheckout() {
            if (cart.items.length === 0) {
                showNotification('Carrello vuoto!', 'error');
                return;
            }
            cart.checkout();
        }

        function updateCartDisplay() {
            const display = document.getElementById('cart-items-display');
            
            if (cart.items.length === 0) {
                display.innerHTML = '<p style="color: #718096; text-align: center; padding: 20px;">Carrello vuoto</p>';
                document.getElementById('cart-total-display').textContent = '0.00';
                return;
            }
            
            display.innerHTML = cart.items.map(item => `
                <div class="cart-item">
                    <div>
                        <strong>${item.name}</strong>
                        <div style="font-size: 14px; color: #718096;">‚Ç¨${item.price.toFixed(2)}</div>
                    </div>
                    <button onclick="cartRemoveItem('${item.id}')" style="padding: 5px 10px; margin: 0; background: linear-gradient(135deg, #f56565 0%, #c53030 100%);">
                        ‚ùå
                    </button>
                </div>
            `).join('');
            
            document.getElementById('cart-total-display').textContent = cart.getTotal().toFixed(2);
        }

        function updateCartStats() {
            document.getElementById('items-in-cart').textContent = cart.items.length;
            document.getElementById('items-added-count').textContent = itemsAddedCount;
            document.getElementById('items-removed-count').textContent = itemsRemovedCount;
        }

        updateCartDisplay();
        updateCartStats();
        addLog('log2', 'üí° ShoppingCart estende EventTarget per emettere eventi');

        // Sezione 3: Component System
        let componentEventsCount = 0;
        let componentUpdatesCount = 0;
        let dataLoadsCount = 0;
        let isLoggedIn = false;
        let currentUser = null;

        // Setup component event listeners
        document.addEventListener('userLoggedIn', (e) => {
            if (e.detail.source === 'Header') {
                componentEventsCount++;
                componentUpdatesCount += 3;
                isLoggedIn = true;
                currentUser = e.detail.data;
                
                document.getElementById('header-username').textContent = currentUser.name;
                document.getElementById('sidebar-content').innerHTML = `
                    <p style="font-size: 14px; margin: 10px 0;">
                        <strong>üìä Dashboard</strong>
                    </p>
                    <p style="font-size: 14px; margin: 10px 0;">
                        <strong>üë§ Profile</strong>
                    </p>
                    <p style="font-size: 14px; margin: 10px 0;">
                        <strong>‚öôÔ∏è Settings</strong>
                    </p>
                `;
                document.getElementById('content-display').innerHTML = `
                    <p><strong>Welcome back, ${currentUser.name}!</strong></p>
                    <p style="margin-top: 10px; opacity: 0.9;">You have access to all features.</p>
                `;
                
                updateComponentStats();
                addLog('log3', `‚úÖ User logged in: ${currentUser.name}`, 'component');
            }
        });

        document.addEventListener('userLoggedOut', (e) => {
            if (e.detail.source === 'Header') {
                componentEventsCount++;
                componentUpdatesCount += 3;
                isLoggedIn = false;
                currentUser = null;
                
                document.getElementById('header-username').textContent = 'Not logged in';
                document.getElementById('sidebar-content').innerHTML = '<p style="font-size: 14px; opacity: 0.8;">Login to see menu</p>';
                document.getElementById('content-display').innerHTML = '<p>Welcome! Please login to access content.</p>';
                
                updateComponentStats();
                addLog('log3', 'üö™ User logged out', 'component');
            }
        });

        document.addEventListener('dataLoaded', (e) => {
            if (e.detail.source === 'Content') {
                componentEventsCount++;
                componentUpdatesCount++;
                dataLoadsCount++;
                
                updateComponentStats();
                addLog('log3', `üìä Data loaded: ${e.detail.data.records} records`, 'component');
            }
        });

        function componentLogin() {
            const event = new CustomEvent('userLoggedIn', {
                detail: {
                    source: 'Header',
                    data: {
                        id: 1,
                        name: 'Mario Rossi',
                        email: 'mario@example.com'
                    }
                },
                bubbles: true
            });
            
            document.dispatchEvent(event);
            showNotification('Login successful!', 'success');
        }

        function componentLogout() {
            const event = new CustomEvent('userLoggedOut', {
                detail: { source: 'Header' },
                bubbles: true
            });
            
            document.dispatchEvent(event);
            showNotification('Logged out', 'info');
        }

        function componentLoadData() {
            if (!isLoggedIn) {
                showNotification('Please login first!', 'error');
                return;
            }
            
            const event = new CustomEvent('dataLoaded', {
                detail: {
                    source: 'Content',
                    data: {
                        records: Math.floor(Math.random() * 100) + 1,
                        timestamp: Date.now()
                    }
                },
                bubbles: true
            });
            
            document.dispatchEvent(event);
            showNotification('Data loaded successfully!', 'success');
        }

        function componentRefresh() {
            if (!isLoggedIn) {
                showNotification('Please login first!', 'error');
                return;
            }
            
            componentUpdatesCount++;
            updateComponentStats();
            addLog('log3', 'üîÑ Content refreshed', 'component');
            showNotification('Content refreshed', 'info');
        }

        function updateComponentStats() {
            document.getElementById('component-events').textContent = componentEventsCount;
            document.getElementById('component-updates').textContent = componentUpdatesCount;
            document.getElementById('data-loads').textContent = dataLoadsCount;
        }

        updateComponentStats();
        addLog('log3', 'üí° I componenti comunicano tramite eventi - completamente disaccoppiati!');
        addLog('log3', '   Ogni componente ascolta solo gli eventi che gli interessano');
    </script>
</body>
</html>
